<template>
    <div class="form-container">
         <el-form
            ref="dataForm"
            :rules="rules"
            :model="form"
            label-position="right"
            label-width="120px"
         >
#foreach($column in $columns)
    #set($field=$column.javaField)
    #if($column.insert && !$column.pk)
        #if(($column.usableColumn) || (!$column.superColumn))
            #set($parentheseIndex=$column.columnComment.indexOf("（"))
            #if($parentheseIndex != -1)
                #set($comment=$column.columnComment.substring(0, $parentheseIndex))
            #else
                #set($comment=$column.columnComment)
            #end
            #set($dictType=$column.dictType)
            #if($column.htmlType == "input")
            <el-form-item label="${comment}" prop="${field}">
              <el-input
              v-model="form.${field}"
              placeholder="请输入${comment}"
              :readonly="operateType == 'view'"
              />
            </el-form-item>
#elseif($column.htmlType == "select" && "" != $dictType)
            <el-form-item label="${comment}">
              <el-select
                v-model="form.${field}"
                placeholder="请选择${comment}"
                :disabled="operateType == 'view'"
              >
                <el-option
                    v-for="item in ${column.javaField}Options"
                    :key="item.value"
                    :label="item.chName"
                    :value="item.value"
                />
              </el-select>
            </el-form-item>

#elseif($column.htmlType == "select" && $dictType )
            <el-form-item label="${comment}">
              <el-select
                v-model="form.${field}"
                placeholder="请选择${comment}"
                :disabled="operateType == 'view'"
                >
                <el-option label="非字典选择项，请自行生成" value="" />
              </el-select>
            </el-form-item>
#elseif($column.htmlType == "cascader" )
            <el-form-item label="${comment}">
                <el-cascader
                  v-model="form.${field}"
                  :options="${column.javaField}Options"
                  :props="{ checkStrictly: true }"
                  :show-all-levels="false"
                  clearable
                  filterable
                  :disabled="operateType == 'view'"
                  @change="handleSelect${column.javaField}"
                />
            </el-form-item>
#elseif($column.htmlType == "radio" && "" != $dictType)
            <el-form-item label="${comment}">
              <el-radio-group v-model="form.${field}">
                <el-radio
                  v-for="dict in ${field}Options"
                  :key="dict.value"
                  :label="dict.chName"
                  :disabled="operateType == 'view'"
                >{{ dict.chName }}</el-radio>
              </el-radio-group>
            </el-form-item>
#elseif($column.htmlType == "radio" && $dictType)
            <el-form-item label="${comment}">
              <el-radio-group v-model="form.${field}">
                <el-radio
                  label="1"
                  :disabled="operateType == 'view'"
                >请选择字典生成</el-radio>
              </el-radio-group>
            </el-form-item>
#elseif($column.htmlType == "datetime")
            <el-form-item label="${comment}" prop="${field}">
              <el-date-picker clearable size="small" style="width: 200px"
                v-model="form.${field}"
                type="date"
                value-format="yyyy-MM-dd"
                :disabled="operateType == 'view'"
                placeholder="选择${comment}">
              </el-date-picker>
            </el-form-item>
#elseif($column.htmlType == "textarea")
            <el-form-item label="${comment}" prop="${field}">
              <el-input
                v-model="form.${field}"
                type="textarea"
                :autosize="{ minRows: 2, maxRows: 4}"
                :readonly="operateType == 'view'"
                placeholder="请输入内容" />
            </el-form-item>
#end
        #end
    #end
#end
        </el-form>
    </div>
</template>

<script>
import { save${BusinessName}, update${BusinessName} } from "@/api/${moduleName}/${businessName}";
import { treeToCascader } from '@/utils/cascader'
import { getDicByCode } from '@/api/admin/common/dic'
export default {
  props: {
    operateType: {
      type: String,
      default: undefined
    }
  },
  data() {
    return {
      form: {
#foreach ($column in $columns)
    #if($column.htmlType == "radio")
        $column.javaField: 0#if($velocityCount != $columns.size()),#end
    #else
        $column.javaField: undefined#if($velocityCount != $columns.size()),#end
    #end
#end
      },
#foreach ($column in $columns)
    #if(${column.dictType} != '')
    ${column.javaField}Options: [],
    #end
#end
       // 表单校验
      rules: {
#foreach ($column in $columns)
    #if($column.required)
        #set($parentheseIndex=$column.columnComment.indexOf("（"))
        #if($parentheseIndex != -1)
            #set($comment=$column.columnComment.substring(0, $parentheseIndex))
        #else
            #set($comment=$column.columnComment)
        #end
        #set($comment=$column.columnComment)
        $column.javaField: [
          { required: true, message: "$comment不能为空", trigger: "blur" }
        ]#if($velocityCount != $columns.size()),#end

    #end
#end
      }
    }
  },
  created() {
#foreach ($column in $columns)
    #if($column.htmlType == "select" && ${column.dictType} != '')
    this.getDicByCode("${column.dictType}").then(res => {
      this.${column.javaField}Options = res.data
    })
    #elseif($column.htmlType == "cascader" && ${column.dictType} != '')
    this.getDicByCode("${column.dictType}").then(res => {
      this.${column.javaField}Options = treeToCascader(res.data)
    })
    #end
#end
  },
  methods: {
    init() {
    },
    // 表单重置
    reset() {
      this.$refs['dataForm'].resetFields()
    },
    validateForm() {
      return this.$refs['dataForm'].validate()
    },
#foreach ($column in $columns)
    #if($column.htmlType == "cascader" && ${column.dictType} != '')
    handleSelect${column.javaField}(data) {
      this.form.${field} = data[data.length - 1]
    },
    #end
#end
    create() {
      if (this.validateForm()) {
        save${BusinessName}(this.form).then((res) => {
          if (res.success) {
            this.messageBox.success('添加成功')
          } else {
            this.messageBox.error('添加失败')
          }
        }).then(() => {
          this.reset()
        })
      }
    },
    update() {
      if (this.validateForm()) {
        update${BusinessName}(this.form).then((res) => {
          if (res.success) {
            this.messageBox.success('修改成功')
          } else {
            this.messageBox.error('修改失败')
          }
        }).then(() => {
          this.reset()
        })
      }
    }
  }

}
</script>
